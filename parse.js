!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var n=e();for(var o in n)("object"==typeof exports?exports:t)[o]=n[o]}}(this,(function(){return function(t){var e={};function n(o){if(e[o])return e[o].exports;var i=e[o]={i:o,l:!1,exports:{}};return t[o].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=t,n.c=e,n.d=function(t,e,o){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(o,i,function(e){return t[e]}.bind(null,i));return o},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=22)}({2:function(t,e,n){"use strict";var o,i;function r(t,e){return t&&"object"==typeof t&&t._type==e}function u(){let t="abcdefhijkmnprstwxyz",e=t.length,n="";for(let o=0;o<6;o++)n+=t.charAt(Math.floor(Math.random()*e));return"u_"+n}n.d(e,"c",(function(){return w})),n.d(e,"d",(function(){return M})),n.d(e,"a",(function(){return o})),n.d(e,"e",(function(){return r})),n.d(e,"b",(function(){return s})),function(t){t[t.FRAME=0]="FRAME",t[t.NODE=1]="NODE",t[t.PIN=2]="PIN",t[t.JOINT=3]="JOINT",t[t.CONNECTION=4]="CONNECTION"}(o||(o={})),function(t){t.each=function(t,...e){e.forEach(e=>{e&&e.forEach(t)})},t.find=function(t,...e){let n;return e.find(e=>{if(e)return n=e.find(e=>t(e))}),n}}(i||(i={}));const s="UNDEFINED_FRAME_LABEL";var c=n(3);function f(t){let e=t;e._exe||(e._exe=function(n,i,r,u){if(!g())return;const s=t.finishPin.forkedFrom||t.finishPin;if("function"!=typeof s._exe){const n=Object(c.isTypeof)(t.startPin.parent,o.NODE)?t.startPin.parent:void 0;throw new Error(`连接(来自:${n?n.runtime.title:"未知组件"}，${e.title})已断开.`)}I.debug&&I.debug.stepTime,s._exe(n,i,r,u)})}let p;function a(t,e){const n=function t(e,n,o,i){let r={id:u(),instId:n,hostId:o,path:void 0,parent:e,returnParams:{},resolve:null,comInsts:{},applyScope(e,n,o,i){const u=t(r,e,o,i);let s=r.comInsts[e];return s&&(!s.scopes&&(s.scopes=[]),s.scopes.push(u)),l(e,o,u),u}};if(i)r.path=r.id;else{const t=[r.id];let e=r.parent;for(;e;)e.parent&&t.push(e.id),e=e.parent;r.path=t.reverse().join(":")}return r}(void 0,t,e);return l(t,e,n),n}function d(t,e){var n;return null===(n=p[t])||void 0===n?void 0:n[e]}function l(t,e,n){let o=p[t];o||(p[t]=o={}),o[e]=n}function _(t,e,n="runtime"){t.conAry&&t.conAry.forEach(t=>{f(t)}),t._exe=function(i,u,s,c){if(!g())return;D.execute&&D.execute(o.PIN,t.id,u);let f=i;if(!f)if(r(t.parent,o.NODE)){const e=t.parent.parent;f=d(!e._exeAsRoot_&&e.parent?e.parent.runtime.id:void 0,e.id)}else if(r(t.parent,o.FRAME)){const e=t.parent;f=d(!e._exeAsRoot_&&e.parent?e.parent.runtime.id:void 0,e.id)}let p=e.pin?e.pin(t):void 0;if(p){if(!1===p.exe(u,c))return}const a=e=>{p&&p.exe(e,t,"返回"),"function"==typeof s&&s(e)};if("input"==t.direction)if(t.proxyPin&&t.proxyPin._exe){t.proxyPin.parent._exe(f,{[t.hostId]:u},void 0,t.direction)}else t.parent._exe(f,void 0,{[t.hostId]:u},a);else if("inner-input"===t.direction){if(!t.proxyPin||!t.proxyPin._exe)return;t.proxyPin._exe(f.parent,u,a,c)}else if("output"==t.direction||"inner-output"==t.direction)if(t.proxyPin&&t.proxyPin._exe)t.proxyPin._exe(i.parent,u,a,c);else{let e;"mock"===n&&t.mockData&&(e=t.mockData),t.conAry&&t.conAry.length>0&&t.conAry.forEach((n,o)=>{let i;a&&(void 0!==e?a(JSON.parse(t.mockData)):i=function(t){a(t)}),n._exe(f,u,i,t)})}}}function m(t,e,n="runtime"){i.each(t=>_(t,e,n),t.inputPins,t.inputPinExts,t.inputPinsInModel),i.each(t=>_(t,e,n),t.outputPins,t.inputPinExts,t.outputPinsInModel);const o=t,r=e.node(t),u={};o._exe=function(e,n,o,c){let f;i.each(t=>{void 0!==t.dummyData&&(!f&&(f={}),f[t.hostId]=t.dummyData)},t.inputPins,t.inputPinsInModel),o=f?Object.assign(f,o):o,u[e.id]||(!function(e,n=s){if("function"!=typeof r.render)throw new Error("Render config function for node not found.");const o=e.path,i={};t.frames&&t.frames.forEach(t=>{i[t.id]=function(n,o=s){const i=t._exe(e,n,o);if(i)return i.path}});const u={inst:r.render(o,n,i,e),scopes:[]};e.comInsts[t.runtime.id]=u}(e,n),u[e.id]=!0);const p=e.comInsts[t.runtime.id];if(o)for(let t in o){const e=o[t];p.inst.inputs[t]=[e,c]}r.exe&&r.exe(p.inst,o,c)},t.frames&&t.frames.forEach(t=>{y(t,e)})}let h=new WeakMap;function x(t,e,n="runtime"){const o=t.parent.parent.runtime;t.from?f(t.from):console.warn(`组件(${o.title},${o.def.namespace})存在连接断开.`),t.to?f(t.to):console.warn(`组件(${o.title},${o.def.namespace})存在连接断开.`);t._exe=function(n,o,i){const r=e.joint?e.joint(t):void 0,u=t.parent.parent;if("input"==t.type){let e=n.comInsts[u.runtime.id].scopes.find(e=>e.hostId===t.parent.id);const s=e=>{r&&r.exe(o),t.to&&t.to._exe(e,o,i,t.type)};if(e){let t=e.hostId;e.parent.comInsts[u.runtime.id].scopes.forEach(e=>{e.hostId==t&&s(e)})}else{let e=h.get(t);e||h.set(t,e=new WeakMap);let o=e.get(n);o||e.set(n,o=[]),o.push(s)}}else r&&"function"==typeof r.exe&&r.exe(o),t.to&&t.to._exe(n.parent,o,i,t.type)}}function y(t,e,n="runtime"){t.comAry&&t.comAry.forEach(t=>{m(t,e,n)}),t.inputPins&&t.inputPins.forEach(t=>_(t,e,n)),t.outputPins&&t.outputPins.forEach(t=>_(t,e,n)),t.inputJoints&&t.inputJoints.forEach(t=>x(t,e,n)),t.outputJoints&&t.outputJoints.forEach(t=>x(t,e,n));const o=t,i={};o._exe=function(e,r,u=s,c,f){if(!e){if(t.parent){const n=d(t.parent?t.parent.runtime.id:t.id,t.id);n&&(e=n.parent)}e||(e=a(void 0,t.id+"-parent"))}const p=u+e.id;if(!i[p]){let n,r;if(o._exeAsRoot_=!!f,u=void 0!==u?u:s,o._exeAsRoot_)n={inst:void 0,scopes:[]};else if(n=e.comInsts[t.parent.runtime.id],!n&&t._rootF)return;"input"==(c="string"==typeof c?c:"input")&&(r=e.applyScope(!o._exeAsRoot_&&t.parent?t.parent.runtime.id:void 0,u,t.id,t._rootF),t.comAry.forEach(t=>{t._exe(r,u,void 0,void 0)})),i[p]={myInstScope:n,curScope:r}}const{myInstScope:l,curScope:_}=i[p];if("input"==(c="string"==typeof c?c:"input")){const e={};if("mock"===n&&t.inputPins.length>0&&t.inputPins.forEach(t=>{t.mockData&&(e[t.hostId]=t.mockData)}),r=Object.assign(e,r))for(let e in r){const n=t.inputPins.find(t=>t.hostId==e);n?n._exe(_,r[e],void 0):"undefined"!=typeof console&&"function"==typeof console.error&&console.error(`No inputPin(id=${e}) found`)}return t.inputJoints&&t.inputJoints.forEach(t=>{!function(t,e){let n=e.parent,o=h.get(t);if(o){let t=o.get(n);t&&t.forEach(t=>{t(e)})}}(t,_)}),_}if(c.match(/^(output)|(inner-input)$/gi)){let e=_;if(t.outputPins.length){if(r)for(let t in r)e.returnParams[t]=r[t]||null;t.outputPins.find(t=>null==e.returnParams[t.hostId])||e.resolve()}}}}let P,E,b,v=null;let O="stop";function g(){return"running"===O}let I={},D={};function w(t,e,n="runtime"){return function(t,e){if(!r(t,e))throw new Error("Invalid item type")}(t,o.FRAME),y(t,e,n),v={on(t,e){t&&"string"==typeof t&&"function"==typeof e&&(D[t.toLowerCase()]=e)},run(e=t,n){if("stop"===O&&(p={}),function(t){return Object.assign(I,t||{}),E=[],b=[],!0}(n))return function(){function t(t){try{t.exe&&t.exe()}catch(t){D.error?D.error(t):console.error(t)}e(P)}function e(n){if("stop"==O||n!==P)return;let o;if("pause"==O&&setTimeout(e,1e3),b.length>0?o=b.shift():E.length>0&&(o=E.shift()),o){I.debug?setTimeout(()=>{t(o)},o.debugSleep):"number"==typeof o.sleep&&o.sleep>-1?setTimeout(()=>{t(o)},0):t(o)}else setTimeout(t=>e(n))}O="running",P=u(),e(P),new Promise((t,e)=>{})}(),t=>{e._exe(void 0,t,void 0,"input",!0)}},pause:j,stop(){const t=(O="stop",!0);return v=null,E=void 0,b=void 0,p={},t}}}function j(){return O="pause",!0}function M(t,e){const n={_all:{},_waiting:{},set(t,e){this._all[t]=e;const n=this._waiting[t];if(n)try{n.forEach(t=>{e(t)}),delete this._waiting[t]}finally{}return!0},get(t){return this._all[t]},waiting(t,e){let n=this._waiting[t];n||(n=this._waiting[t]=[]),n.push(e)}},o={};return{inputs:new Proxy({},{ownKeys(e){const n=[];return i.each(t=>{n.push(t.hostId)},t.inputPins,t.inputPinsInModel),n},getOwnPropertyDescriptor:t=>({enumerable:!0,configurable:!0}),get:(t,e,i)=>function(t){n.set(e,(function(n){const i=o[e];if(void 0!==n&&i){o[e]=void 0;const[i,r]=n;t(i,(function(t){"function"==typeof r&&r(t)}))}}))},set(t,i,r,u){o[i]=r;const s=n.get(i);return s?((null==e?void 0:e.input)&&e.input(),s(r)):n.waiting(i,r),!0}}),outputs:new Proxy({},{ownKeys(e){const n=[];return i.each(t=>{n.push(t.hostId)},t.outputPins,t.outputPinsInModel),n},getOwnPropertyDescriptor:t=>({enumerable:!0,configurable:!0}),get(n,o,r){let u;return function(n,r){if(t.outputPins){u=r;const s=function(t){"function"==typeof u&&u(t)},c=i.find(({hostId:t})=>o==t,t.outputPins,t.outputPinsInModel);if(!c)throw new Error(`No output(hostId=${o}) found.`);setTimeout(()=>{(null==e?void 0:e.output)&&e.output(n),c._exe(null,n,s,t)})}}}})}}},22:function(t,e,n){"use strict";n.r(e),n.d(e,"parse",(function(){return u}));var o=n(2);let i,r={};function u(t){r={};const e=t["xg.desn.stageview"],{def:n,refs:u}=e;i=u;const c=[],f=s(n._ref_).mainModule;if(f.frame){!function t(e){e.comAry&&e.comAry.forEach(e=>{if(Object(o.e)(e,o.a.NODE)){const{runtime:n}=e,o=n.def.namespace+"@"+n.def.version;c.indexOf(o)<=0&&(n.def.namespace.startsWith("xg-comlib")||n.def.namespace.startsWith("xgraph.coms.module")||c.push(o)),e.frames&&e.frames.forEach(e=>t(e))}})}(f.frame)}return{mainModule:f,requireComs:c}}function s(t){let e=r[t];return e||(r[t]=e=i[t],function t(e){if("object"==typeof e&&e){if(e._ref_)return s(e._ref_);Object.keys(e).forEach(n=>{let o=e[n];Array.isArray(o)?o.forEach((e,n)=>{o[n]=t(e)}):e[n]=t(o)})}return e}(e),e)}},3:function(module,exports,__webpack_require__){var e;e=function(){return function(t){var e={};function n(o){if(e[o])return e[o].exports;var i=e[o]={i:o,l:!1,exports:{}};return t[o].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=t,n.c=e,n.d=function(t,e,o){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(o,i,function(e){return t[e]}.bind(null,i));return o},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=9)}([function(t,e,n){"use strict";function o(t,e){if(!i(t,e))throw new Error("Invalid item type")}function i(t,e){return t&&"object"==typeof t&&t._type==e}function r(){let t="abcdefhijkmnprstwxyz",e=t.length,n="";for(let o=0;o<6;o++)n+=t.charAt(Math.floor(Math.random()*e));return"u_"+n}var u;n.d(e,"b",(function(){return o})),n.d(e,"c",(function(){return i})),n.d(e,"d",(function(){return r})),n.d(e,"a",(function(){return u})),function(t){t.each=function(t,...e){e.forEach(e=>{e&&e.forEach(t)})},t.find=function(t,...e){let n;return e.find(e=>{if(e)return n=e.find(e=>t(e))}),n}}(u||(u={}))},function(t,e,n){"use strict";var o;n.d(e,"a",(function(){return o})),function(t){t[t.FRAME=0]="FRAME",t[t.NODE=1]="NODE",t[t.PIN=2]="PIN",t[t.JOINT=3]="JOINT",t[t.CONNECTION=4]="CONNECTION"}(o||(o={}))},function(t,e,n){"use strict";n.d(e,"d",(function(){return d})),n.d(e,"b",(function(){return l})),n.d(e,"c",(function(){return _})),n.d(e,"a",(function(){return m}));var o=n(1),i=n(0),r=n(8),u=n(3);let s,c,f,p=null,a="stop";function d(){return"running"===a}let l={},_={};function m(t,e,n="runtime"){return Object(i.b)(t,o.a.FRAME),Object(r.a)(t,e,n),p={on(t,e){t&&"string"==typeof t&&"function"==typeof e&&(_[t.toLowerCase()]=e)},run(e=t,n){if("stop"===a&&Object(u.c)(),function(t){return Object.assign(l,t||{}),c=[],f=[],!0}(n))return function(){function t(t){try{t.exe&&t.exe()}catch(t){_.error?_.error(t):console.error(t)}e(s)}function e(n){if("stop"==a||n!==s)return;let o;"pause"==a&&setTimeout(e,1e3),f.length>0?o=f.shift():c.length>0&&(o=c.shift()),o?l.debug?setTimeout(()=>{t(o)},o.debugSleep):"number"==typeof o.sleep&&o.sleep>-1?setTimeout(()=>{t(o)},0):t(o):setTimeout(t=>e(n))}a="running",s=Object(i.d)(),e(s),new Promise((t,e)=>{})}(),t=>{e._exe(void 0,t,void 0,"input",!0)}},pause:h,stop(){const t=(a="stop",!0);return p=null,c=void 0,f=void 0,Object(u.d)(),t}}}function h(){return a="pause",!0}},function(t,e,n){"use strict";n.d(e,"a",(function(){return r})),n.d(e,"b",(function(){return u})),n.d(e,"c",(function(){return s})),n.d(e,"d",(function(){return c}));var o=n(0);let i;function r(t,e){const n=function t(e,n,i,r){let u={id:Object(o.d)(),instId:n,hostId:i,path:void 0,parent:e,returnParams:{},resolve:null,comInsts:{},applyScope(e,n,o,i){const r=t(u,e,o,i);let s=u.comInsts[e];return s&&(!s.scopes&&(s.scopes=[]),s.scopes.push(r)),f(e,o,r),r}};if(r)u.path=u.id;else{const t=[u.id];let e=u.parent;for(;e;)e.parent&&t.push(e.id),e=e.parent;u.path=t.reverse().join(":")}return u}(void 0,t,e);return f(t,e,n),n}function u(t,e){var n;return null===(n=i[t])||void 0===n?void 0:n[e]}function s(){i={}}function c(){i={}}function f(t,e,n){let o=i[t];o||(i[t]=o={}),o[e]=n}},function(t,e,n){"use strict";n.d(e,"a",(function(){return c}));var o=n(0),i=n(7),r=n(1),u=n(3),s=n(2);function c(t,e,n="runtime"){t.conAry&&t.conAry.forEach(t=>{Object(i.a)(t)}),t._exe=function(i,c,f,p){if(!Object(s.d)())return;s.c.execute&&s.c.execute(r.a.PIN,t.id,c);let a=i;if(!a)if(Object(o.c)(t.parent,r.a.NODE)){const e=t.parent.parent;a=Object(u.b)(!e._exeAsRoot_&&e.parent?e.parent.runtime.id:void 0,e.id)}else if(Object(o.c)(t.parent,r.a.FRAME)){const e=t.parent;a=Object(u.b)(!e._exeAsRoot_&&e.parent?e.parent.runtime.id:void 0,e.id)}let d=e.pin?e.pin(t):void 0;if(d&&!1===d.exe(c,p))return;const l=e=>{d&&d.exe(e,t,"返回"),"function"==typeof f&&f(e)};if("input"==t.direction)t.proxyPin&&t.proxyPin._exe?t.proxyPin.parent._exe(a,{[t.hostId]:c},void 0,t.direction):t.parent._exe(a,void 0,{[t.hostId]:c},l);else if("inner-input"===t.direction){if(!t.proxyPin||!t.proxyPin._exe)return;t.proxyPin._exe(a.parent,c,l,p)}else if("output"==t.direction||"inner-output"==t.direction)if(t.proxyPin&&t.proxyPin._exe)t.proxyPin._exe(i.parent,c,l,p);else{let e;"mock"===n&&t.mockData&&(e=t.mockData),t.conAry&&t.conAry.length>0&&t.conAry.forEach((n,o)=>{let i;l&&(void 0!==e?l(JSON.parse(t.mockData)):i=function(t){l(t)}),n._exe(a,c,i,t)})}}}},function(t,e,n){"use strict";n.d(e,"a",(function(){return o}));const o="UNDEFINED_FRAME_LABEL"},function(t,e,n){"use strict";var o=n(9);n.d(e,"b",(function(){return o.isTypeof}));var i=n(5);n.d(e,"a",(function(){return i.a}))},function(t,e,n){"use strict";n.d(e,"a",(function(){return u}));var o=n(2),i=n(1),r=n(6);function u(t){let e=t;e._exe||(e._exe=function(n,u,s,c){if(!Object(o.d)())return;const f=t.finishPin.forkedFrom||t.finishPin;if("function"!=typeof f._exe){const n=Object(r.b)(t.startPin.parent,i.a.NODE)?t.startPin.parent:void 0;throw new Error(`连接(来自:${n?n.runtime.title:"未知组件"}，${e.title})已断开.`)}o.b.debug&&o.b.debug.stepTime,f._exe(n,u,s,c)})}},function(t,e,n){"use strict";n.d(e,"a",(function(){return p}));var o=n(5),i=n(10),r=n(4),u=n(7);let s=new WeakMap;function c(t,e,n="runtime"){const o=t.parent.parent.runtime;t.from?Object(u.a)(t.from):console.warn(`组件(${o.title},${o.def.namespace})存在连接断开.`),t.to?Object(u.a)(t.to):console.warn(`组件(${o.title},${o.def.namespace})存在连接断开.`),t._exe=function(n,o,i){const r=e.joint?e.joint(t):void 0,u=t.parent.parent;if("input"==t.type){let e=n.comInsts[u.runtime.id].scopes.find(e=>e.hostId===t.parent.id);const c=e=>{r&&r.exe(o),t.to&&t.to._exe(e,o,i,t.type)};if(e){let t=e.hostId;e.parent.comInsts[u.runtime.id].scopes.forEach(e=>{e.hostId==t&&c(e)})}else{let e=s.get(t);e||s.set(t,e=new WeakMap);let o=e.get(n);o||e.set(n,o=[]),o.push(c)}}else r&&"function"==typeof r.exe&&r.exe(o),t.to&&t.to._exe(n.parent,o,i,t.type)}}var f=n(3);function p(t,e,n="runtime"){t.comAry&&t.comAry.forEach(t=>{Object(i.a)(t,e,n)}),t.inputPins&&t.inputPins.forEach(t=>Object(r.a)(t,e,n)),t.outputPins&&t.outputPins.forEach(t=>Object(r.a)(t,e,n)),t.inputJoints&&t.inputJoints.forEach(t=>c(t,e,n)),t.outputJoints&&t.outputJoints.forEach(t=>c(t,e,n));const u=t,p={};u._exe=function(e,i,r=o.a,c,a){if(!e){if(t.parent){const n=Object(f.b)(t.parent?t.parent.runtime.id:t.id,t.id);n&&(e=n.parent)}e||(e=Object(f.a)(void 0,t.id+"-parent"))}const d=r+e.id;if(!p[d]){let n,i;if(u._exeAsRoot_=!!a,r=void 0!==r?r:o.a,u._exeAsRoot_)n={inst:void 0,scopes:[]};else if(n=e.comInsts[t.parent.runtime.id],!n&&t._rootF)return;"input"==(c="string"==typeof c?c:"input")&&(i=e.applyScope(!u._exeAsRoot_&&t.parent?t.parent.runtime.id:void 0,r,t.id,t._rootF),t.comAry.forEach(t=>{t._exe(i,r,void 0,void 0)})),p[d]={myInstScope:n,curScope:i}}const{myInstScope:l,curScope:_}=p[d];if("input"==(c="string"==typeof c?c:"input")){const e={};if("mock"===n&&t.inputPins.length>0&&t.inputPins.forEach(t=>{t.mockData&&(e[t.hostId]=t.mockData)}),i=Object.assign(e,i))for(let e in i){const n=t.inputPins.find(t=>t.hostId==e);n?n._exe(_,i[e],void 0):"undefined"!=typeof console&&"function"==typeof console.error&&console.error(`No inputPin(id=${e}) found`)}return t.inputJoints&&t.inputJoints.forEach(t=>{!function(t,e){let n=e.parent,o=s.get(t);if(o){let t=o.get(n);t&&t.forEach(t=>{t(e)})}}(t,_)}),_}if(c.match(/^(output)|(inner-input)$/gi)){let e=_;if(t.outputPins.length){if(i)for(let t in i)e.returnParams[t]=i[t]||null;t.outputPins.find(t=>null==e.returnParams[t.hostId])||e.resolve()}}}}},function(t,e,n){"use strict";n.r(e),n.d(e,"compile",(function(){return o.a})),n.d(e,"createIO",(function(){return r})),n.d(e,"E_ItemType",(function(){return u.a})),n.d(e,"isTypeof",(function(){return i.c}));var o=n(2),i=n(0);function r(t,e){const n={_all:{},_waiting:{},set(t,e){this._all[t]=e;const n=this._waiting[t];if(n)try{n.forEach(t=>{e(t)}),delete this._waiting[t]}finally{}return!0},get(t){return this._all[t]},waiting(t,e){let n=this._waiting[t];n||(n=this._waiting[t]=[]),n.push(e)}},o={};return{inputs:new Proxy({},{ownKeys(e){const n=[];return i.a.each(t=>{n.push(t.hostId)},t.inputPins,t.inputPinsInModel),n},getOwnPropertyDescriptor:t=>({enumerable:!0,configurable:!0}),get:(t,e,i)=>function(t){n.set(e,(function(n){const i=o[e];if(void 0!==n&&i){o[e]=void 0;const[i,r]=n;t(i,(function(t){"function"==typeof r&&r(t)}))}}))},set(t,i,r,u){o[i]=r;const s=n.get(i);return s?((null==e?void 0:e.input)&&e.input(),s(r)):n.waiting(i,r),!0}}),outputs:new Proxy({},{ownKeys(e){const n=[];return i.a.each(t=>{n.push(t.hostId)},t.outputPins,t.outputPinsInModel),n},getOwnPropertyDescriptor:t=>({enumerable:!0,configurable:!0}),get(n,o,r){let u;return function(n,r){if(t.outputPins){u=r;const s=function(t){"function"==typeof u&&u(t)},c=i.a.find(({hostId:t})=>o==t,t.outputPins,t.outputPinsInModel);if(!c)throw new Error(`No output(hostId=${o}) found.`);setTimeout(()=>{(null==e?void 0:e.output)&&e.output(n),c._exe(null,n,s,t)})}}}})}}var u=n(1)},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return compile}));var _index__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(6),_Frame__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(8),_Pin__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(4),_util__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(0);function compile(node,opts,mode="runtime"){_util__WEBPACK_IMPORTED_MODULE_3__.a.each(t=>Object(_Pin__WEBPACK_IMPORTED_MODULE_2__.a)(t,opts,mode),node.inputPins,node.inputPinExts,node.inputPinsInModel),_util__WEBPACK_IMPORTED_MODULE_3__.a.each(t=>Object(_Pin__WEBPACK_IMPORTED_MODULE_2__.a)(t,opts,mode),node.outputPins,node.inputPinExts,node.outputPinsInModel);const nodeRunnable=node,nodeOpts=opts.node(node),rendered={};let runtimeScriptFn;function render(t,e=_index__WEBPACK_IMPORTED_MODULE_0__.a){if("function"!=typeof nodeOpts.render)throw new Error("Render config function for node not found.");const n=t.path,o={};node.frames&&node.frames.forEach(e=>{o[e.id]=function(n,o=_index__WEBPACK_IMPORTED_MODULE_0__.a){const i=e._exe(t,n,o);if(i)return i.path}});const i={inst:nodeOpts.render(n,e,o),scopes:[]};t.comInsts[node.runtime.id]=i}nodeRunnable._exe=function(scope,frameLable,params,callback){let debugParams;_util__WEBPACK_IMPORTED_MODULE_3__.a.each(t=>{void 0!==t.dummyData&&(!debugParams&&(debugParams={}),debugParams[t.hostId]=t.dummyData)},node.inputPins,node.inputPinsInModel),params=debugParams?Object.assign(debugParams,params):params,rendered[scope.id]||(render(scope,frameLable),rendered[scope.id]=!0);const instDesc=scope.comInsts[node.runtime.id];if(params)for(let t in params){const e=params[t];instDesc.inst.inputs[t]=[e,callback]}nodeOpts.exe&&nodeOpts.exe(instDesc.inst,params,callback);const rtScript=node.runtime.model.script;if(rtScript)if("js"===rtScript.type){if(!runtimeScriptFn){const script=rtScript.content,sc=unescape(script);try{runtimeScriptFn=eval(sc)}catch(t){throw new Error(`组件[${node.def.namespace}] 脚本发生错误:${t.message}\n            ${sc}`)}}runtimeScriptFn(instDesc.inst.inputs,instDesc.inst.outputs,opts.envVars)}else if("extComponent"===rtScript.type){const extDef=node.runtime.def.extension;if(opts.extComDef&&!runtimeScriptFn){let extComDef;const extDesc=opts.extComDef.find(t=>t.pointId===extDef.pointId);if(extDesc&&extDesc.comAry&&(extComDef=extDesc.comAry.find(t=>t.id===extDef.instId),!extComDef))throw new Error(`No extComponent(id=${extDef.instId}) defined found.`);const script=rtScript.content;try{runtimeScriptFn=eval(script)(extComDef,node.runtime.model.data),runtimeScriptFn(instDesc.inst.inputs,instDesc.inst.outputs,opts.envVars)}catch(t){throw new Error(`ExtComponent(${extComDef.title}) script error:${t.message}\n                  ${script}`)}}}else if("jsEval"===rtScript.type){if(!runtimeScriptFn){const script=rtScript.content,sc=script;try{runtimeScriptFn=eval(sc)(node.runtime.model)}catch(t){throw new Error(`组件[${node.def.namespace}] 脚本发生错误:${t.message}\n            ${sc}`)}}runtimeScriptFn(instDesc.inst.inputs,instDesc.inst.outputs,opts.envVars)}else if("extPoint"===rtScript.type){const t=rtScript.content;if(t&&opts.extComDef){const e=opts.extComDef.find(e=>e.id===t);if(!e)throw new Error(`No controlPoint(id=${t}) found.`);const n=function(n,o){Object.keys(n).forEach(o=>{n[o](n=>{if(e.inputs){const i=e.inputs.find(t=>t.id===o);if(!i)throw new Error(`No input(id=${o}) defined in extPoint(id=${t}) found.`);i.exe({data:rtScript.data},n)}})}),Object.keys(o).forEach(n=>{o[n](o=>{if(e.outputs){const i=e.outputs.find(t=>t.id===n);if(!i)throw new Error(`No output(id=${n}) defined in extPoint(id=${t}) found.`);i.exe({data:rtScript.data},o)}})})};n(instDesc.inst.inputs,instDesc.inst.outputs)}}},node.frames&&node.frames.forEach(t=>{Object(_Frame__WEBPACK_IMPORTED_MODULE_1__.a)(t,opts)})}}])},module.exports=e()}})}));